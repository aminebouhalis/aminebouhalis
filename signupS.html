<!doctype html> 
<html lang="ar">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SignUp Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <style>
      .form-group { margin-bottom: 15px; }
      label { display: block; margin-bottom: 5px; }
      input, select { width: 100%; padding: 8px; }
      .error { color: red; }
      #form {
        width: 400px;
        margin: 30px auto;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0px 0px 8px #ccc;
      }
      #heading {
        text-align: center;
        margin-bottom: 20px;
      }
    </style>
  </head>

  <body>
    <div id="form">
      <h1 id="heading">SignUp Form</h1><br>
      <form id="signupForm" method="POST">
        <i class="fa fa-user fa-lg"></i>
        <input type="text" id="user" name="user" placeholder="Enter Username" required><br><br>

        <div class="form-group">
          <label>المستوى الحالي:</label>
          <select name="current_level" required>
            <option value="L1"> (L1)</option>
            <option value="L2">(L2)</option>
            <option value="L3">(L3)</option>
            <option value="M1"> (M1)</option>
            <option value="M2">(M2)</option>
          </select>
        </div>

        <input type="date" id="bacyear" name="bacyear" required><br><br>
        <input type="number" name="id" id="id" placeholder="Insert your registr number of bac" required><br><br>

        <i class="fa-solid fa-envelope fa-lg"></i>
        <input type="email" id="email" name="email" placeholder="Enter Email" required><br><br>

        <i class="fa-solid fa-lock fa-lg"></i>
        <input type="password" id="pass" name="pass" placeholder="Create Password" required><br><br>

        <i class="fa-solid fa-lock fa-lg"></i>
        <input type="password" id="cpass" name="cpass" placeholder="Retype Password" required><br><br>

        <input type="submit" id="btn" value="SignUp"/>
      </form>
      <br>
      <button><a href="index.php">Go to home</a></button>
    </div>

    <script type="module">
      // استيراد Firebase
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
      import { 
        getAuth, 
        createUserWithEmailAndPassword, 
        sendEmailVerification 
      } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

      // 🔹 ضع إعدادات مشروعك هنا من Firebase Console
      const firebaseConfig = {
        apiKey: "AIzaSyBQf_tjUTzUs688js-Runv6eawj4Hv2FWk",
        authDomain: "department-computer-science.firebaseapp.com",
        projectId: "department-computer-science",
        storageBucket: "department-computer-science.firebasestorage.app",
        messagingSenderId: "189934401736",
        appId: "G-SP2P9WT486"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      const form = document.getElementById("signupForm");
      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = document.getElementById("email").value;
        const password = document.getElementById("pass").value;
        const confirm = document.getElementById("cpass").value;

        if (password !== confirm) {
          alert("كلمة المرور غير متطابقة");
          return;
        }

        try {
          // إنشاء الحساب
          const userCredential = await createUserWithEmailAndPassword(auth, email, password);
          const user = userCredential.user;

          // إرسال رابط تحقق البريد
          await sendEmailVerification(user);

          // إرسال البيانات للـ PHP
          const formData = new FormData(form);
          formData.append("uid", user.uid);

          const response = await fetch("signupS.php", {
            method: "POST",
            body: formData
          });

          const result = await response.text();
          alert("تم إنشاء الحساب ✔️ تحقق من بريدك الإلكتروني لتفعيل الحساب.\n" );

        } catch (error) {
          alert("خطأ: " + error.message);
        }
      });
    </script>
  </body>
</html>
