<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SignUp Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
     <style>
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input, select { width: 100%; padding: 8px; }
        .error { color: red; }
    </style>
  </head>

   <body>
      <div id="form">
            <h1 id="heading">SignUp Form</h1><br>
            <form name="form" action="signupS.php" method="POST">
                <i class="fa fa-user fa-lg"></i>
                <input type="text" id="user" name="user" placeholder="Enter Username" required></br></br>
              <div class="form-group">
            <label>المستوى الحالي:</label>
            <select name="current_level" required>
                <option value="L1">المستوى الأول (L1)</option>
                <option value="L2">المستوى الثاني (L2)</option>
                <option value="L3">المستوى الثالث (L3)</option>
                <option value="M1">ماستر 1 (M1)</option>
                <option value="M2">ماستر 2 (M2)</option>
            </select>
        </div>
    <input type="date" id="bacyear" name="bacyear" placeholder="Insert your date of bac" required><br><br>
    <input type="number" name="id" id="id" placeholder="Insert your registr number of bac" required><br><br>
<i class="fa-solid fa-envelope fa-lg"></i>
                <input type="email" id="email" name="email" placeholder="Enter Email" required></br></br>
                <i class="fa-solid fa-lock fa-lg"></i>
                <input type="password" id="pass" name="pass" placeholder="Create Password" required></br></br>
                <i class="fa-solid fa-lock fa-lg"></i>
                <input type="password" id="cpass" name="cpass" placeholder="Retype Password" required></br></br>
                <input type="submit" id="btn" value="SignUp" name = "submit"/>
            </form>
              <br><button><a href="index.php">Go to home</a></button>
      </div>
     <script type="module">
  // استيراد مكتبات Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword } 
    from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

  // إعدادات مشروعك (انسخها من Firebase Console)
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };

  // تهيئة Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // 🔹 عند الضغط على زر التسجيل
  const form = document.querySelector("form");
  form.addEventListener("submit", async (e) => {
    e.preventDefault(); // منع الإرسال المباشر

    const email = document.getElementById("email").value;
    const password = document.getElementById("pass").value;
    const confirm = document.getElementById("cpass").value;

    if (password !== confirm) {
      alert("كلمة المرور غير متطابقة");
      return;
    }

    try {
      // إنشاء حساب على Firebase
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      // إرسال باقي البيانات لـ PHP + UID من Firebase
      const formData = new FormData(form);
      formData.append("uid", user.uid);

      const response = await fetch("signupS.php", {
        method: "POST",
        body: formData
      });

      const result = await response.text();
      alert("تم إنشاء الحساب ✔️\n" + result);


    } catch (error) {
      alert("خطأ: " + error.message);
    }
  });
</script>
  </body>
</html>
